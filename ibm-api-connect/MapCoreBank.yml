kind: DataPowerAssembly
apiVersion: api.ibm.com/v1
metadata:
  name: MapCoreBank
  namespace: core-banking-v2
  version: '1.0'
  tags: []
  labels:
    gatewayTypes:
      - datapower
spec:
  x-ibm-configuration:
    enforced: true
    testable: true
    phase: realized
    gateway: datapower-api-gateway
    assembly:
      execute:
        - switch:
            version: 2.1.0
            title: switch
            case:
              - condition: ($header("x-source")="mobileapp")
                execute:
                  - invoke:
                      version: 2.3.0
                      title: invoke new core
                      backend-type: json
                      header-control:
                        type: blocklist
                        values: []
                      parameter-control:
                        type: allowlist
                        values: []
                      http-version: HTTP/1.1
                      timeout: 60
                      verb: GET
                      chunked-uploads: true
                      persistent-connection: true
                      cache-response: protocol
                      cache-ttl: 900
                      websocket-upgrade: false
                      target-url: >-
                        https://new-core-rt-core-bank.apps.itz-ycynma.infra01-lb.dal14.techzone.ibm.com/accounts/{accountId}/balance
                      description: |-
                        response example: {
                          "code": "00",
                          "msg": "SUCCESS",
                          "acctId": "MockAccId",
                          "availBal": 10500.99,
                          "curr": "THB",
                          "lastUpd": "2026-02-06T15:30:00+07:00",
                          "coreId": "NEW"
                        }
              - condition: ($header("x-source")="atm" or $header("x-source")="cdm")
                execute:
                  - invoke:
                      version: 2.3.0
                      title: invoke old core
                      backend-type: json
                      header-control:
                        type: blocklist
                        values: []
                      parameter-control:
                        type: allowlist
                        values: []
                      http-version: HTTP/1.1
                      timeout: 60
                      verb: GET
                      chunked-uploads: true
                      persistent-connection: true
                      cache-response: protocol
                      cache-ttl: 900
                      websocket-upgrade: false
                      target-url: >-
                        https://old-core-rt-core-bank.apps.itz-ycynma.infra01-lb.dal14.techzone.ibm.com/BALINQ?ACCT_NO={accountId}
                      output: ''
                      description: >-
                        response example:
                        00SUCCESSMockAccId000000001050099THB20260206153000OLD
                  - gatewayscript:
                      title: ''
